<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Checklist ‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£‡∏ù‡∏∂‡∏Å‡∏≠‡∏ö‡∏£‡∏° (‡∏®.1) - Multi Save</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;600;700&display=swap');

        :root {
            --primary: #4f46e5;
            --primary-dark: #4338ca;
            --bg-color: #f1f5f9;
            --container-bg: #ffffff;
            --text-main: #1e293b;
            --text-muted: #64748b;
            
            --theme-blue-bg: #eff6ff;
            --theme-blue-border: #bfdbfe;
            --theme-blue-icon: #3b82f6;
            
            --theme-orange-bg: #fff7ed;
            --theme-orange-border: #fed7aa;
            --theme-orange-icon: #f97316;
            
            --theme-green-bg: #f0fdf4;
            --theme-green-border: #bbf7d0;
            --theme-green-icon: #22c55e;
            
            --theme-red-bg: #fef2f2;
            --theme-red-border: #fecaca;
            --theme-red-icon: #ef4444;
            
            --theme-purple-bg: #f5f3ff;
            --theme-purple-border: #ddd6fe;
            --theme-purple-icon: #8b5cf6;
        }

        body {
            font-family: 'Sarabun', sans-serif;
            background-color: var(--bg-color);
            margin: 0;
            padding: 20px;
            color: var(--text-main);
            display: flex;
            justify-content: center;
            min-height: 100vh;
            box-sizing: border-box;
        }

        .container {
            background: var(--container-bg);
            width: 100%;
            max-width: 800px;
            border-radius: 24px;
            box-shadow: 0 20px 40px -5px rgba(0,0,0,0.1), 0 10px 15px -5px rgba(0,0,0,0.05);
            overflow: hidden;
            position: relative;
            display: flex;
            flex-direction: column;
            min-height: 850px;
            transition: all 0.3s ease;
        }

        /* Header Area */
        .header {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            padding: 25px 30px;
            text-align: center;
            color: white;
            position: relative;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            z-index: 10;
        }

        .header h1 { margin: 0 0 5px 0; font-size: 22px; font-weight: 700; }
        .header p { margin: 0; opacity: 0.95; font-size: 14px; font-weight: 300; }
        
        .header-home-btn {
            position: absolute;
            top: 20px; right: 20px;
            background: rgba(255,255,255,0.2);
            border: 1px solid rgba(255,255,255,0.4);
            color: white; padding: 6px 12px;
            border-radius: 20px; cursor: pointer;
            font-family: 'Sarabun'; font-weight: 600; font-size: 13px;
            display: flex; align-items: center; gap: 6px;
            backdrop-filter: blur(4px);
        }
        .header-home-btn:hover { background: rgba(255,255,255,0.3); }
        
        /* Save Slot Indicator in Header */
        .slot-badge-container {
            display: flex; justify-content: center; align-items: center; gap: 8px; margin-top: 8px;
        }
        .slot-badge {
            display: inline-flex; align-items: center; gap: 5px;
            background: rgba(0,0,0,0.2); padding: 4px 12px;
            border-radius: 12px; font-size: 13px;
        }
        .header-edit-btn {
            background: rgba(255,255,255,0.2); border: none; cursor: pointer;
            color: white; border-radius: 50%; width: 24px; height: 24px;
            display: flex; align-items: center; justify-content: center; font-size: 12px;
            transition: 0.2s;
        }
        .header-edit-btn:hover { background: rgba(255,255,255,0.4); }

        /* Progress Bar */
        .progress-container { background: #f8fafc; border-bottom: 1px solid #e2e8f0; }
        .progress-wrapper { background: #e2e8f0; height: 6px; width: 100%; }
        .progress-fill { height: 100%; background: linear-gradient(90deg, #10b981, #059669); width: 0%; transition: width 0.6s; }
        .stats { padding: 10px 30px; font-size: 13px; color: var(--text-muted); font-weight: 600; display: flex; justify-content: space-between; }

        /* Step Indicators */
        .step-indicators { display: flex; justify-content: center; padding: 15px 0; background: #fff; border-bottom: 1px solid #f1f5f9; }
        .step-dot { width: 10px; height: 10px; border-radius: 50%; background: #cbd5e1; margin: 0 6px; transition: all 0.3s; }
        .step-dot.active { background: var(--primary); transform: scale(1.3); }
        .step-dot.completed { background: #10b981; }

        /* Content */
        .content { padding: 20px 30px; flex-grow: 1; overflow-y: auto; position: relative; }
        .step-section { display: none; animation: fadeIn 0.4s ease; }
        .step-section.active { display: block; }
        .section-title { font-size: 18px; font-weight: 700; margin: 0 0 20px; border-bottom: 2px solid #f1f5f9; padding-bottom: 10px; display: flex; align-items: center; }
        .badge { padding: 4px 10px; border-radius: 6px; font-size: 12px; color: white; margin-right: 10px; text-transform: uppercase; }

        /* Tasks */
        .task-item { display: flex; align-items: flex-start; padding: 15px; margin-bottom: 10px; border-radius: 10px; border: 1px solid #f1f5f9; background: white; cursor: pointer; transition: 0.2s; box-shadow: 0 2px 4px rgba(0,0,0,0.02); }
        .task-item:hover { transform: translateY(-2px); border-color: #e2e8f0; box-shadow: 0 4px 8px rgba(0,0,0,0.05); }
        .task-item.checked { opacity: 0.75; background: #f8fafc; border-color: #e2e8f0; }
        .checkbox-custom { width: 22px; height: 22px; border: 2px solid #cbd5e1; border-radius: 6px; margin-right: 15px; display: flex; align-items: center; justify-content: center; flex-shrink: 0; background: white; }
        .task-item.checked .checkbox-custom { background: #10b981; border-color: #10b981; }
        .task-item.checked .checkbox-custom svg { transform: scale(1); }
        .task-text { font-weight: 600; font-size: 15px; display: block; margin-bottom: 3px; }
        .task-detail { font-size: 13px; color: var(--text-muted); }
        .checkbox-custom svg { width: 14px; height: 14px; color: white; transform: scale(0); transition: 0.2s; }
        
        /* Action Links within Tasks */
        .task-actions { margin-top: 8px; display: flex; gap: 10px; flex-wrap: wrap; }
        .action-link {
            display: inline-flex; align-items: center; gap: 4px;
            font-size: 12px; text-decoration: none;
            background: #eff6ff; color: var(--primary);
            padding: 4px 10px; border-radius: 15px;
            border: 1px solid var(--theme-blue-border);
            transition: 0.2s;
            cursor: pointer;
        }
        .action-link:hover { background: var(--primary); color: white; border-color: var(--primary); }

        /* Themes */
        .theme-blue .badge { background: var(--theme-blue-icon); } .theme-blue .task-item { border-left: 4px solid var(--theme-blue-icon); }
        .theme-orange .badge { background: var(--theme-orange-icon); } .theme-orange .task-item { border-left: 4px solid var(--theme-orange-icon); }
        .theme-green .badge { background: var(--theme-green-icon); } .theme-green .task-item { border-left: 4px solid var(--theme-green-icon); }
        .theme-red .badge { background: var(--theme-red-icon); } .theme-red .task-item { border-left: 4px solid var(--theme-red-icon); }
        .theme-purple .badge { background: var(--theme-purple-icon); } .theme-purple .task-item { border-left: 4px solid var(--theme-purple-icon); }

        /* Calculator */
        .calculator-panel { margin-top: 15px; background: #f8fafc; padding: 15px; border-radius: 10px; border: 1px solid #e2e8f0; font-size: 14px; cursor: auto; }
        .calc-row { display: flex; align-items: center; gap: 10px; margin-bottom: 8px; flex-wrap: wrap; }
        .calc-row label { width: 130px; color: var(--text-muted); font-weight: 500; }
        .calc-input { padding: 6px 10px; border: 1px solid #cbd5e1; border-radius: 6px; width: 100px; font-family: inherit; }
        .calc-input:focus { outline: none; border-color: var(--primary); }
        .calc-input:disabled { background: #e2e8f0; color: #64748b; cursor: not-allowed; border-color: #cbd5e1; }
        .calc-result { margin-top: 12px; padding-top: 12px; border-top: 1px dashed #cbd5e1; font-weight: 700; color: var(--primary); text-align: right; }
        .warning-text { color: #ef4444; font-size: 12px; font-weight: 700; margin-left: 5px; display: none; }
        .input-text-area { width: 100%; border: 1px solid #cbd5e1; border-radius: 6px; padding: 8px; font-family: 'Sarabun'; margin-top: 5px; box-sizing: border-box; }
        
        /* Date Rows */
        .date-row { display: flex; gap: 5px; align-items: center; margin-bottom: 8px; flex-wrap: wrap; background: white; padding: 5px; border-radius: 6px; border: 1px solid #e2e8f0; }
        .remove-date-btn { background: #fee2e2; color: #ef4444; border: 1px solid #fca5a5; border-radius: 4px; padding: 4px 8px; cursor: pointer; font-size: 12px; }
        .remove-date-btn:hover { background: #fecaca; }

        /* Summary Box */
        .summary-box { background: #fff; border: 2px solid #e2e8f0; border-radius: 15px; padding: 20px; box-shadow: 0 5px 15px rgba(0,0,0,0.03); margin-bottom: 20px; }
        .summary-row { display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px dashed #f1f5f9; font-size: 14px; }
        .summary-total { margin-top: 15px; padding: 15px; background: var(--theme-blue-bg); border-radius: 10px; font-weight: 700; display: flex; justify-content: space-between; color: var(--primary-dark); font-size: 18px; }

        /* Save Slots UI */
        .slots-grid { display: grid; gap: 15px; padding: 10px; }
        .slot-card {
            background: white; border: 2px solid #e2e8f0; border-radius: 16px; padding: 15px 20px;
            display: flex; justify-content: space-between; align-items: center;
            transition: all 0.2s; cursor: pointer; position: relative;
        }
        .slot-card:hover { transform: translateY(-3px); box-shadow: 0 10px 20px -5px rgba(0,0,0,0.05); border-color: var(--theme-blue-border); }
        .slot-card.empty { border-style: dashed; opacity: 0.8; }
        .slot-info h3 { margin: 0 0 5px 0; font-size: 16px; color: var(--text-main); font-weight: 700; }
        .slot-info p { margin: 0; font-size: 13px; color: var(--text-muted); }
        .slot-status { font-size: 12px; padding: 3px 8px; border-radius: 12px; font-weight: 600; }
        .status-empty { background: #f1f5f9; color: #94a3b8; }
        .status-active { background: #dcfce7; color: #166534; }
        
        .slot-actions { display: flex; gap: 8px; }
        .btn-icon { background: none; border: 1px solid #e2e8f0; cursor: pointer; padding: 8px; border-radius: 50%; transition: 0.2s; color: #64748b; display: flex; align-items: center; justify-content: center; width: 36px; height: 36px; }
        .btn-icon:hover { background: #f1f5f9; color: var(--text-main); border-color: #cbd5e1; }
        .btn-delete:hover { background: #fef2f2; color: #ef4444; border-color: #fca5a5; }
        .btn-edit:hover { background: #eff6ff; color: var(--primary); border-color: var(--theme-blue-border); }
        .btn-print-slot:hover { background: #f0fdf4; color: #15803d; border-color: #86efac; }
        
        /* Home Contact Button */
        .home-contact-btn {
            display: inline-flex; align-items: center; gap: 8px;
            background: #f8fafc; color: #64748b;
            padding: 10px 24px; border-radius: 30px;
            text-decoration: none; font-weight: 600; font-size: 14px;
            border: 1px solid #e2e8f0; transition: all 0.2s;
            cursor: pointer;
            font-family: 'Sarabun', sans-serif;
        }
        .home-contact-btn:hover {
            background: white; color: var(--primary); border-color: var(--primary);
            box-shadow: 0 4px 12px rgba(79, 70, 229, 0.1); transform: translateY(-2px);
        }

        /* Footer & Modals */
        .footer { padding: 20px 30px; background: white; border-top: 1px solid #f1f5f9; display: flex; justify-content: space-between; }
        .nav-btn { border: none; padding: 10px 20px; border-radius: 10px; font-weight: 600; cursor: pointer; display: flex; align-items: center; gap: 8px; font-family: 'Sarabun'; }
        .btn-prev { background: #f1f5f9; color: #64748b; }
        .btn-next { background: var(--primary); color: white; }
        .btn-print { background: var(--text-main); color: white; width: 100%; margin-bottom: 10px; justify-content: center; }
        .btn-save { background: #10b981; color: white; width: 100%; margin-bottom: 10px; justify-content: center; }
        .btn-save:hover { background: #059669; }
        
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); display: none; justify-content: center; align-items: center; z-index: 100; backdrop-filter: blur(2px); }
        .modal-overlay.active { display: flex; animation: fadeIn 0.2s; }
        .modal-box { background: white; padding: 30px; border-radius: 20px; width: 90%; max-width: 350px; text-align: center; box-shadow: 0 20px 40px rgba(0,0,0,0.2); }
        .modal-title { font-size: 18px; font-weight: 700; margin-bottom: 10px; }
        .modal-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 20px; }
        .select-card { border: 2px solid #e2e8f0; padding: 15px; border-radius: 12px; cursor: pointer; transition: 0.2s; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .select-card:hover { border-color: var(--primary); background: var(--theme-blue-bg); }
        .select-icon { font-size: 32px; display: block; margin-bottom: 8px; }
        
        .modal-input { width: 100%; padding: 12px; border: 1px solid #cbd5e1; border-radius: 8px; margin-top: 10px; font-family: 'Sarabun'; font-size: 16px; box-sizing: border-box; transition: 0.2s; }
        .modal-input:focus { outline: none; border-color: var(--primary); box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1); }
        .input-error { border-color: #ef4444; animation: shake 0.3s; }

        @keyframes shake { 0%, 100% {transform: translateX(0);} 25% {transform: translateX(-5px);} 75% {transform: translateX(5px);} }

        .hidden-visually { display: none !important; }
        .hidden { display: none !important; } /* Standard hidden class */
        .hidden-row { display: none; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* --- PRINT CSS FIXED (Aggressive Reset) --- */
        @media print {
            @page { size: A4; margin: 1cm; }
            body { 
                background: white !important; 
                display: block !important;
                height: auto !important;
                width: 100% !important;
                margin: 0 !important;
                padding: 0 !important;
                font-size: 12pt;
                color: black !important;
                overflow: visible !important; /* Force scrollbars off/visible */
            }
            .container { 
                position: static !important;
                width: 100% !important; 
                max-width: 100% !important; 
                height: auto !important;
                box-shadow: none !important; 
                border: none !important; 
                margin: 0 !important; 
                padding: 0 !important;
                display: block !important;
                overflow: visible !important;
            }
            .content { 
                overflow: visible !important; 
                height: auto !important; 
                padding: 0 !important;
                display: block !important;
                margin: 0 !important;
            }
            
            /* Header adjustments for print */
            .header {
                background: none !important;
                color: black !important;
                padding: 10px 0;
                box-shadow: none !important;
                text-align: left;
                border-bottom: 2px solid #000;
                margin-bottom: 20px;
                display: block !important;
            }
            .header h1 { font-size: 18pt; color: black; margin-bottom: 5px; }
            .header p { display: none; } 
            
            /* Hide UI elements */
            .header-home-btn, .header-edit-btn, #progress-area, #step-nav, .footer, .slot-actions, .action-link, .remove-date-btn, .btn-icon, .btn-save, .btn-print, .btn-reset, .home-contact-btn, #welcome-screen, .modal-overlay, .warning-text, .badge { 
                display: none !important; 
            }

            /* Show Content */
            #checklist-steps, #slot-indicator, .step-section { 
                display: block !important; 
                visibility: visible !important;
            }
            
            /* Step styling */
            .step-section { margin-bottom: 30px; page-break-inside: avoid; }
            .section-title { 
                border-bottom: 1px solid #000; 
                color: black; 
                font-size: 14pt; 
                margin-bottom: 15px;
            }
            
            /* Task items */
            .task-item { 
                border: none; 
                box-shadow: none; 
                padding: 5px 0; 
                page-break-inside: avoid;
            }
            .task-item.hidden { display: none !important; }
            
            /* Calculator/Inputs */
            .calculator-panel { 
                background: none; 
                border: none; 
                padding: 0; 
                margin-top: 5px; 
            }
            input, select, textarea {
                border: none !important;
                background: transparent !important;
                box-shadow: none !important;
                padding: 0 !important;
                font-weight: 600;
                color: black !important;
                width: auto !important;
                display: inline-block;
            }
            
            /* Checkbox simulation */
            .checkbox-custom { border: 2px solid #000; }
            .task-item.checked .checkbox-custom { background: #000; border-color: #000; }
            
            /* Summary Box specific */
            .summary-box { border: 1px solid #000; box-shadow: none; }
            .summary-total { background: #eee; color: black; }
        }
    </style>
</head>
<body>

    <div class="container">
        
        <!-- Header -->
        <div class="header">
            <button id="header-home-btn" class="header-home-btn hidden-visually" onclick="confirmBackToHome()">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path><polyline points="9 22 9 12 15 12 15 22"></polyline></svg>
                ‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å
            </button>
            
            <h1>üìã ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£‡∏ù‡∏∂‡∏Å‡∏≠‡∏ö‡∏£‡∏° (‡∏®.1)</h1>
            <p>‡∏£‡∏∞‡∏ö‡∏ö‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥ (Multi-Save)</p>
            <div id="slot-indicator" class="slot-badge-container hidden-visually">
                <span class="slot-badge" id="slot-name-badge"></span>
                <button class="header-edit-btn" onclick="openRenameModal(currentSlotId)" title="‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ä‡∏∑‡πà‡∏≠‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£">‚úé</button>
            </div>
        </div>

        <!-- Progress Bar -->
        <div id="progress-area" class="progress-container hidden-visually">
            <div class="progress-wrapper"><div class="progress-fill" id="progressBar"></div></div>
            <div class="stats"><span id="progressText">‡∏£‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°...</span><span id="percentText" style="color:var(--primary);">0%</span></div>
        </div>
        
        <!-- Step Indicators -->
        <div id="step-nav" class="step-indicators hidden-visually">
            <div class="step-dot active" id="dot-1"></div><div class="step-dot" id="dot-2"></div><div class="step-dot" id="dot-3"></div><div class="step-dot" id="dot-4"></div><div class="step-dot" id="dot-5"></div><div class="step-dot" id="dot-6"></div>
        </div>

        <!-- Main Content -->
        <div class="content">
            
            <!-- Welcome / Slot Selection Screen -->
            <div id="welcome-screen">
                <div style="text-align: center; margin-bottom: 30px;">
                    <h2 style="font-size: 24px; font-weight: 700; margin-bottom: 5px;">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏ß‡πâ</h2>
                    <p style="color: var(--text-muted);">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡πà‡∏≠‡∏á‡∏ß‡πà‡∏≤‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÉ‡∏´‡∏°‡πà ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ó‡∏≥‡∏ï‡πà‡∏≠</p>
                </div>

                <div class="slots-grid" id="slots-container">
                    <!-- Slots will be generated by JS -->
                </div>

                <!-- Contact Button -->
                <div style="margin-top: auto; padding-top: 40px; text-align: center; padding-bottom: 10px;">
                    <button class="home-contact-btn" onclick="copyContactEmail(this)">
                        üìß ‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà : nutthapol.kaewr@airportthai.co.th
                    </button>
                </div>
            </div>

            <!-- CHECKLIST STEPS -->
            <div id="checklist-steps" class="hidden-visually">
                
                <!-- STEP 1 -->
                <div id="step-1" class="step-section theme-blue active">
                    <div class="section-title"><div><span class="badge">‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 1</span> ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£</div></div>
                    <div class="task-item" id="task-1" data-type="all" onclick="toggleTask(this)">
                        <div class="checkbox-custom"><svg viewBox="0 0 24 24" fill="currentColor"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/></svg></div>
                        <div class="task-content">
                            <span class="task-text">‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏•‡∏∞‡∏´‡∏•‡∏±‡∏Å‡∏Å‡∏≤‡∏£‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•</span>
                            <span class="task-detail">‡∏£‡∏∞‡∏ö‡∏∏‡∏¢‡∏∏‡∏ó‡∏ò‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå‡πÅ‡∏•‡∏∞‡∏Å‡∏•‡∏¢‡∏∏‡∏ó‡∏ò‡πå‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á‡πÉ‡∏´‡πâ‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô</span>
                            <div class="task-actions" onclick="event.stopPropagation()">
                                <a href="https://airportthai-my.sharepoint.com/:i:/g/personal/nutthapol_kaewr_airportthai_co_th/IQD71zPKqeRWRY988nSrsoJAAaw1J9D4FHqgqcy0URhAgAI?e=Ioj7dH" target="_blank" class="action-link">üìñ ‡∏î‡∏π‡∏¢‡∏∏‡∏ó‡∏ò‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå ‡∏ó‡∏≠‡∏ó.</a>
                            </div>
                        </div>
                    </div>
                    <div class="task-item" id="task-2" data-type="all" onclick="toggleTask(this)">
                        <div class="checkbox-custom"><svg viewBox="0 0 24 24" fill="currentColor"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/></svg></div>
                        <div class="task-content">
                            <span class="task-text">‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå "‡∏Ñ‡πà‡∏≤‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÉ‡∏ô‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î"</span>
                            <span class="task-detail">‡∏Å‡∏£‡∏ì‡∏µ‡∏°‡∏µ‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏Å‡∏∞ (‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡πá‡∏ô 1 ‡πÉ‡∏ô 120 ‡∏´‡∏•‡∏±‡∏Å‡∏™‡∏π‡∏ï‡∏£ ‡∏™‡∏ö‡∏ß‡∏ó.)</span>
                            <div class="task-actions" onclick="event.stopPropagation()">
                                <a href="https://airportthai-my.sharepoint.com/:x:/g/personal/nutthapol_kaewr_airportthai_co_th/IQBB7kyjIj41QLt_OWvzEA-wAe-CXQeO_1t4zch8ge8Ptis?e=bnekxv" target="_blank" class="action-link">üìñ ‡∏î‡∏π 120 ‡∏´‡∏•‡∏±‡∏Å‡∏™‡∏π‡∏ï‡∏£ ‡∏™‡∏ö‡∏ß‡∏ó.</a>
                            </div>
                        </div>
                    </div>
                    <div class="task-item" id="task-3" data-type="all" onclick="toggleTask(this)">
                        <div class="checkbox-custom"><svg viewBox="0 0 24 24" fill="currentColor"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/></svg></div>
                        <div class="task-content">
                            <span class="task-text">‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå‡πÅ‡∏•‡∏∞‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå</span>
                        </div>
                    </div>
                </div>

                <!-- STEP 2 -->
                <div id="step-2" class="step-section theme-orange">
                    <div class="section-title"><div><span class="badge">‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 2</span> ‡∏´‡∏•‡∏±‡∏Å‡∏™‡∏π‡∏ï‡∏£ ‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà ‡πÅ‡∏•‡∏∞‡∏ú‡∏π‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏≠‡∏ö‡∏£‡∏°</div></div>
                    
                    <div class="task-item" id="task-4" data-type="all" onclick="toggleTask(this)">
                        <div class="checkbox-custom"><svg viewBox="0 0 24 24" fill="currentColor"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/></svg></div>
                        <div class="task-content">
                            <span class="task-text">‡∏à‡∏±‡∏î‡∏ó‡∏≥‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏ß‡∏¥‡∏ä‡∏≤‡πÅ‡∏•‡∏∞‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏ù‡∏∂‡∏Å‡∏≠‡∏ö‡∏£‡∏°</span>
                            <span class="task-detail">‡πÅ‡∏ô‡∏ö‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Å‡∏≤‡∏£‡πÅ‡∏•‡∏∞‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏ß‡∏¥‡∏ä‡∏≤‡πÉ‡∏´‡πâ‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô</span>
                        </div>
                    </div>

                    <!-- Date & Location -->
                    <div class="task-item" id="task-date-loc" data-type="all" onclick="toggleTask(this)">
                        <div class="checkbox-custom"><svg viewBox="0 0 24 24" fill="currentColor"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/></svg></div>
                        <div class="task-content" style="width: 100%;">
                            <span class="task-text">‡∏ß‡∏±‡∏ô ‡πÄ‡∏ß‡∏•‡∏≤ ‡πÅ‡∏•‡∏∞ ‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà</span>
                            <div class="calculator-panel" onclick="event.stopPropagation()">
                                
                                <div id="date-rows-container">
                                    <!-- Dynamic rows will go here -->
                                </div>
                                <button class="action-link" style="margin-top:5px;" onclick="addDateRow(); event.stopPropagation();">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ä‡πà‡∏ß‡∏á‡∏ß‡∏±‡∏ô</button>

                                <div class="calc-result" id="trainingDaysResult" style="text-align:left; color:var(--text-muted); font-size:13px; border:none; margin-top:5px; padding-top:0;">‡∏£‡∏ß‡∏°‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤: 0 ‡∏ß‡∏±‡∏ô</div>
                                
                                <div style="margin-top:10px; padding-top:10px; border-top:1px dashed #cbd5e1;">
                                    
                                    <!-- Internal Logic -->
                                    <div id="loc-internal-opt" class="hidden-visually">
                                        <div class="task-item" style="border:none; padding:5px; margin:0; box-shadow:none; background:none;">
                                            <input type="checkbox" id="checkRoomInternal" style="margin-right:8px;"> <span style="font-size:14px;">‡∏à‡∏≠‡∏á‡∏´‡πâ‡∏≠‡∏á‡∏ù‡∏∂‡∏Å‡∏≠‡∏ö‡∏£‡∏°‡∏†‡∏≤‡∏¢‡πÉ‡∏ô ‡∏ó‡∏≠‡∏ó.</span>
                                        </div>
                                    </div>
                                    <!-- External Logic (Shared) -->
                                    <div id="loc-external-opt" class="hidden-visually">
                                        <div class="task-item" style="border:none; padding:5px; margin:0; box-shadow:none; background:none; flex-wrap:wrap;">
                                            <div style="width:100%; margin-bottom:5px;"><input type="checkbox" id="checkHotelExternal" style="margin-right:8px;"> <b>‡∏à‡∏≠‡∏á‡πÇ‡∏£‡∏á‡πÅ‡∏£‡∏°/‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà</b></div>
                                            <input type="text" id="hotelName" class="modal-input" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡πÇ‡∏£‡∏á‡πÅ‡∏£‡∏°/‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà..." style="margin-bottom:5px; padding:6px;">
                                            <input type="text" id="hotelProvince" class="modal-input" placeholder="‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î..." style="padding:6px;">
                                        </div>
                                    </div>
                                </div>

                                <div class="task-actions" style="margin-top:10px;">
                                    <a href="https://airportthai-my.sharepoint.com/:x:/g/personal/nutthapol_kaewr_airportthai_co_th/IQAkxEF63QakRasY1GeCmsgGAQkHCiNXU-JqGhfdzO7BUmQ?e=M9qjWl" target="_blank" class="action-link">üìñ ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏ù‡∏∂‡∏Å‡∏≠‡∏ö‡∏£‡∏°</a>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Trainee Section -->
                    <div class="task-item" id="task-trainee" data-type="all" onclick="toggleTask(this)">
                        <div class="checkbox-custom"><svg viewBox="0 0 24 24" fill="currentColor"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/></svg></div>
                        <div class="task-content" style="width: 100%;">
                            <span class="task-text">‡∏ú‡∏π‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ù‡∏∂‡∏Å‡∏≠‡∏ö‡∏£‡∏°</span>
                            <div class="calculator-panel" onclick="event.stopPropagation()">
                                <div class="calc-row">
                                    <label style="width:160px;">1. ‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏õ‡∏Å‡∏ï‡∏¥ (‡∏Ñ‡∏ô):</label>
                                    <input type="number" id="traineeNormal" value="0" min="0" class="calc-input" oninput="updateTraineeCount()">
                                </div>
                                <div class="calc-row">
                                    <label style="width:160px;">2. ‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏Å‡∏∞ (‡∏Ñ‡∏ô):</label>
                                    <input type="number" id="traineeShift" value="0" min="0" class="calc-input" oninput="updateTraineeCount()">
                                    <span class="warning-text" style="display:inline; color:#64748b; font-weight:400; font-size:11px;">(‡∏Ñ‡∏¥‡∏î‡∏Ñ‡πà‡∏≤‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î)</span>
                                </div>
                                <div class="task-actions" style="margin-top:10px;">
                                    <a href="https://airportthai-my.sharepoint.com/:x:/g/personal/nutthapol_kaewr_airportthai_co_th/IQCBcl3zeH7QQ7JtWlyZJZfsAUH0czarbkkCiM-NfPGF8C0?e=PxxGKm" target="_blank" class="action-link">üìñ ‡∏î‡∏π‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ù‡∏∂‡∏Å‡∏≠‡∏ö‡∏£‡∏°</a>
                                </div>
                                <div class="calc-result" id="traineeTotalResult" style="color:var(--text-main); border-top:1px dashed #cbd5e1; margin-top:10px; padding-top:10px;">
                                    ‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: 0 ‡∏Ñ‡∏ô
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Training Method -->
                    <div class="task-item" id="task-method" data-type="all" onclick="toggleTask(this)">
                        <div class="checkbox-custom"><svg viewBox="0 0 24 24" fill="currentColor"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/></svg></div>
                        <div class="task-content" style="width: 100%;">
                            <span class="task-text">‡∏ß‡∏¥‡∏ò‡∏µ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ù‡∏∂‡∏Å‡∏≠‡∏ö‡∏£‡∏°</span>
                            <div class="calculator-panel" onclick="event.stopPropagation()" style="display:flex; flex-direction:column; gap:8px;">
                                <div><input type="checkbox" id="methodLecture"> ‡∏ö‡∏£‡∏£‡∏¢‡∏≤‡∏¢</div>
                                <div><input type="checkbox" id="methodSeminar"> ‡∏™‡∏±‡∏°‡∏°‡∏ô‡∏≤</div>
                                <div><input type="checkbox" id="methodWorkshop"> ‡∏ù‡∏∂‡∏Å‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥ (Workshop)</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- STEP 3 -->
                <div id="step-3" class="step-section theme-green">
                    <div class="section-title"><div><span class="badge">‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 3</span> ‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏Å‡∏£‡πÅ‡∏•‡∏∞‡∏ú‡∏•‡∏ó‡∏µ‡πà‡∏Ñ‡∏≤‡∏î‡∏´‡∏ß‡∏±‡∏á</div></div>
                    
                    <div class="task-item" id="task-lecturer" data-type="all" onclick="toggleTask(this)">
                        <div class="checkbox-custom"><svg viewBox="0 0 24 24" fill="currentColor"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/></svg></div>
                        <div class="task-content" style="width:100%;">
                            <span class="task-text">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏Å‡∏£</span>
                            <div class="calculator-panel" onclick="event.stopPropagation()">
                                <div class="calc-row"><label style="width:180px; color:#1e293b; font-weight:600;">1. ‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏Å‡∏£‡∏†‡∏≤‡∏¢‡πÉ‡∏ô (‡∏Ñ‡∏ô):</label><input type="number" id="lecIntCount" value="0" class="calc-input"></div>
                                <div class="sub-header" style="margin-top:10px; font-weight:600; font-size:13px;">2. ‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏Å‡∏£‡∏†‡∏≤‡∏¢‡∏ô‡∏≠‡∏Å</div>
                                <div class="calc-row"><label style="width:180px;">- ‡∏ï‡∏±‡∏ß‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏• (‡∏Ñ‡∏ô):</label><input type="number" id="lecExtIndCount" value="0" class="calc-input"></div>
                                <div class="calc-row"><label style="width:180px;">- ‡πÉ‡∏ô‡∏ô‡∏≤‡∏°‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó (‡∏£‡∏≤‡∏¢):</label><input type="number" id="lecExtComCount" value="0" class="calc-input"></div>
                                <div class="task-actions" style="margin-top:10px;">
                                    <a href="#" class="action-link">üìÑ ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥/‡πÉ‡∏ö‡πÄ‡∏™‡∏ô‡∏≠‡∏£‡∏≤‡∏Ñ‡∏≤</a>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="task-item" id="task-results" data-type="all" onclick="toggleTask(this)">
                        <div class="checkbox-custom"><svg viewBox="0 0 24 24" fill="currentColor"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/></svg></div>
                        <div class="task-content" style="width:100%;">
                            <span class="task-text">‡∏ú‡∏•‡∏ó‡∏µ‡πà‡∏Ñ‡∏≤‡∏î‡∏ß‡πà‡∏≤‡∏à‡∏∞‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö</span>
                            <span class="task-detail">(‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ß‡πà‡∏≤‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô)</span>
                        </div>
                    </div>

                    <div class="task-item" id="task-evaluation" data-type="all" onclick="toggleTask(this)">
                        <div class="checkbox-custom"><svg viewBox="0 0 24 24" fill="currentColor"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/></svg></div>
                        <div class="task-content" style="width:100%;">
                            <span class="task-text">‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ù‡∏∂‡∏Å‡∏≠‡∏ö‡∏£‡∏°</span>
                            <span class="task-detail">(‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ß‡πà‡∏≤‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô)</span>
                        </div>
                    </div>

                    <div class="task-item" id="task-cert" data-type="all" onclick="toggleTask(this)">
                        <div class="checkbox-custom"><svg viewBox="0 0 24 24" fill="currentColor"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/></svg></div>
                        <div class="task-content" style="width:100%;">
                            <span class="task-text">‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏ö‡∏£‡∏≠‡∏á‡∏ú‡∏• (‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏Å‡∏≤‡∏£‡∏ú‡πà‡∏≤‡∏ô)</span>
                            <span class="task-detail">(‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ß‡πà‡∏≤‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô)</span>
                        </div>
                    </div>

                    <div class="task-item" id="task-committee" data-type="all" onclick="toggleTask(this)">
                        <div class="checkbox-custom"><svg viewBox="0 0 24 24" fill="currentColor"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/></svg></div>
                        <div class="task-content" style="width:100%;">
                            <span class="task-text">‡∏Ñ‡∏ì‡∏∞‡∏ú‡∏π‡πâ‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏ù‡∏∂‡∏Å‡∏≠‡∏ö‡∏£‡∏°</span>
                            <span class="task-detail">(‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ß‡πà‡∏≤‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô)</span>
                        </div>
                    </div>

                </div>

                <!-- STEP 4 -->
                <div id="step-4" class="step-section theme-red">
                    <div class="section-title"><div><span class="badge">‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 4</span> ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì</div></div>
                    
                    <div class="task-item" id="task-budget-1" data-type="all" onclick="toggleTask(this)">
                        <div class="checkbox-custom"><svg viewBox="0 0 24 24" fill="currentColor"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/></svg></div>
                        <div class="task-content">
                            <span class="task-text">‡∏Ñ‡πà‡∏≤‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏Å‡∏£</span>
                            <div class="calculator-panel" onclick="event.stopPropagation()">
                                <!-- Internal Lecturer -->
                                <div class="sub-header" style="font-size:13px; font-weight:600; color:#4f46e5;">1. ‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏Å‡∏£‡∏†‡∏≤‡∏¢‡πÉ‡∏ô</div>
                                <div class="calc-row"><label>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô ‡∏ä‡∏°.:</label><input type="number" id="speakerIntHours" value="0" min="0" class="calc-input" oninput="updateAllBudgets()"></div>
                                <div class="calc-row"><label>‡∏≠‡∏±‡∏ï‡∏£‡∏≤/‡∏ä‡∏°.:</label><input type="number" value="400" disabled class="calc-input"></div>
                                
                                <!-- External Lecturer -->
                                <div class="sub-header" style="font-size:13px; font-weight:600; color:#f97316; margin-top:8px;">2. ‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏Å‡∏£‡∏†‡∏≤‡∏¢‡∏ô‡∏≠‡∏Å</div>
                                <div class="calc-row"><label>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô ‡∏ä‡∏°.:</label><input type="number" id="speakerExtHours" value="0" min="0" class="calc-input" oninput="updateAllBudgets()"></div>
                                <div class="calc-row"><label>‡∏≠‡∏±‡∏ï‡∏£‡∏≤/‡∏ä‡∏°.:</label><input type="number" id="speakerExtRate" value="0" class="calc-input" oninput="updateAllBudgets()"></div>
                                <div class="warning-text" style="display:block; margin-top:2px; font-weight:400; color:#ef4444; font-size:11px;">(‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô 2,000.- ‡∏ö. ‡∏ñ‡πâ‡∏≤‡πÄ‡∏Å‡∏¥‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡∏Ç‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥)</div>
                                
                                <div class="calc-result" id="speakerTotalResult">‡∏£‡∏ß‡∏°: 0 ‡∏ö‡∏≤‡∏ó</div>
                            </div>
                        </div>
                    </div>

                    <div class="task-item" id="task-budget-speaker-lunch" data-type="all" onclick="toggleTask(this)">
                        <div class="checkbox-custom"><svg viewBox="0 0 24 24" fill="currentColor"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/></svg></div>
                        <div class="task-content">
                            <span class="task-text" id="lunchLabel">‡∏Ñ‡πà‡∏≤‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏Å‡∏•‡∏≤‡∏á‡∏ß‡∏±‡∏ô (800.-)</span>
                            <div style="font-size:12px; color:#64748b; font-weight:400; margin-top:2px; margin-bottom:5px;">(‡∏ú‡∏π‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ù‡∏∂‡∏Å‡∏≠‡∏ö‡∏£‡∏°, ‡∏ú‡∏π‡πâ‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£, ‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏Å‡∏£, ‡∏ú‡∏π‡πâ‡∏™‡∏±‡∏á‡πÄ‡∏Å‡∏ï‡∏Å‡∏≤‡∏£‡∏ì‡πå ‡πÅ‡∏•‡∏∞‡∏ú‡∏π‡πâ‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£)</div>
                            <div class="calculator-panel" onclick="event.stopPropagation()">
                                <div class="calc-row"><label>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏ô:</label><input type="number" id="lunchPeople" value="0" class="calc-input" oninput="updateAllBudgets()"></div>
                                <div class="calc-row"><label>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏°‡∏∑‡πâ‡∏≠:</label><input type="number" id="lunchMeals" value="0" class="calc-input" oninput="updateAllBudgets()"></div>
                                <div class="calc-row"><label>‡∏£‡∏≤‡∏Ñ‡∏≤/‡∏°‡∏∑‡πâ‡∏≠:</label><input type="number" value="800" class="calc-input" disabled></div>
                                <div class="calc-result" id="lunchTotalResult">‡∏£‡∏ß‡∏°: 0 ‡∏ö‡∏≤‡∏ó</div>
                            </div>
                        </div>
                    </div>

                    <!-- Internal Snack -->
                    <div class="task-item" id="task-budget-int" data-type="internal" onclick="toggleTask(this)">
                        <div class="checkbox-custom"><svg viewBox="0 0 24 24" fill="currentColor"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/></svg></div>
                        <div class="task-content">
                            <span class="task-text">‡∏Ñ‡πà‡∏≤‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏ß‡πà‡∏≤‡∏á/‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏î‡∏∑‡πà‡∏° (‡πÄ‡∏£‡∏ó‡∏†‡∏≤‡∏¢‡πÉ‡∏ô)</span>
                            <div style="font-size:12px; color:#64748b; font-weight:400; margin-top:2px; margin-bottom:5px;">(‡∏ú‡∏π‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ù‡∏∂‡∏Å‡∏≠‡∏ö‡∏£‡∏°, ‡∏ú‡∏π‡πâ‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£, ‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏Å‡∏£, ‡∏ú‡∏π‡πâ‡∏™‡∏±‡∏á‡πÄ‡∏Å‡∏ï‡∏Å‡∏≤‡∏£‡∏ì‡πå ‡πÅ‡∏•‡∏∞‡∏ú‡∏π‡πâ‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£)</div>
                            <div class="calculator-panel" onclick="event.stopPropagation()">
                                <div class="calc-row"><label>‡∏Ñ‡∏ô:</label><input type="number" id="snackIntPeople" value="1" class="calc-input" oninput="updateAllBudgets()"></div>
                                <div class="calc-row"><label>‡∏°‡∏∑‡πâ‡∏≠:</label><input type="number" id="snackIntMeals" value="1" class="calc-input" oninput="updateAllBudgets()"></div>
                                <div class="calc-row"><label>‡∏£‡∏≤‡∏Ñ‡∏≤/‡∏°‡∏∑‡πâ‡∏≠:</label><input type="number" value="50" class="calc-input" disabled></div>
                                <div class="calc-result" id="snackIntResult">‡∏£‡∏ß‡∏°: 50 ‡∏ö‡∏≤‡∏ó</div>
                            </div>
                        </div>
                    </div>

                    <!-- External Snack (Both BKK & Prov) -->
                    <div class="task-item" id="task-budget-ext-snack" data-type="external" onclick="toggleTask(this)">
                        <div class="checkbox-custom"><svg viewBox="0 0 24 24" fill="currentColor"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/></svg></div>
                        <div class="task-content">
                            <span class="task-text">‡∏Ñ‡πà‡∏≤‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏ß‡πà‡∏≤‡∏á/‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏î‡∏∑‡πà‡∏° (‡πÄ‡∏£‡∏ó‡∏†‡∏≤‡∏¢‡∏ô‡∏≠‡∏Å)</span>
                            <div style="font-size:12px; color:#64748b; font-weight:400; margin-top:2px; margin-bottom:5px;">(‡∏ú‡∏π‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ù‡∏∂‡∏Å‡∏≠‡∏ö‡∏£‡∏°, ‡∏ú‡∏π‡πâ‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£, ‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏Å‡∏£, ‡∏ú‡∏π‡πâ‡∏™‡∏±‡∏á‡πÄ‡∏Å‡∏ï‡∏Å‡∏≤‡∏£‡∏ì‡πå ‡πÅ‡∏•‡∏∞‡∏ú‡∏π‡πâ‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£)</div>
                            <div class="calculator-panel" onclick="event.stopPropagation()">
                                <div class="calc-row"><label>‡∏Ñ‡∏ô:</label><input type="number" id="snackExtPeople" value="1" class="calc-input" oninput="updateAllBudgets()"></div>
                                <div class="calc-row"><label>‡∏°‡∏∑‡πâ‡∏≠:</label><input type="number" id="snackExtMeals" value="1" class="calc-input" oninput="updateAllBudgets()"></div>
                                <div class="calc-row"><label>‡∏£‡∏≤‡∏Ñ‡∏≤/‡∏°‡∏∑‡πâ‡∏≠:</label><input type="number" value="300" class="calc-input" disabled></div>
                                <div class="calc-result" id="snackExtResult">‡∏£‡∏ß‡∏°: 300 ‡∏ö‡∏≤‡∏ó</div>
                            </div>
                        </div>
                    </div>

                    <!-- Other Expenses (ForAll) -->
                    <div class="task-item" id="task-budget-other" data-type="all" onclick="toggleTask(this)">
                         <div class="checkbox-custom"><svg viewBox="0 0 24 24" fill="currentColor"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/></svg></div>
                         <div class="task-content">
                            <span class="task-text">‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡∏≠‡∏∑‡πà‡∏ô‡πÜ</span>
                            <div class="calculator-panel" onclick="event.stopPropagation()">
                                <input type="text" id="otherExpName" class="modal-input" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢..." style="margin-bottom:8px; margin-top:0;">
                                <div class="calc-row"><label>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏£‡∏ß‡∏°:</label><input type="number" id="otherExpTotal" value="0" class="calc-input" oninput="updateAllBudgets()"></div>
                                <div class="calc-result" id="otherExpResult">‡∏£‡∏ß‡∏°: 0 ‡∏ö‡∏≤‡∏ó</div>
                            </div>
                         </div>
                    </div>
                    
                    <!-- Accommodation (Prov Only) -->
                     <div class="task-item" id="task-budget-accom" data-type="prov-only" onclick="toggleTask(this)">
                        <div class="checkbox-custom"><svg viewBox="0 0 24 24" fill="currentColor"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/></svg></div>
                        <div class="task-content">
                            <span class="task-text">‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏û‡∏±‡∏Å (‡∏ï‡πà‡∏≤‡∏á‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î)</span>
                            <div style="font-size:12px; color:#64748b; font-weight:400; margin-top:2px; margin-bottom:5px;">(‡∏ú‡∏π‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ù‡∏∂‡∏Å‡∏≠‡∏ö‡∏£‡∏°, ‡∏ú‡∏π‡πâ‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£, ‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏Å‡∏£, ‡∏ú‡∏π‡πâ‡∏™‡∏±‡∏á‡πÄ‡∏Å‡∏ï‡∏Å‡∏≤‡∏£‡∏ì‡πå ‡πÅ‡∏•‡∏∞‡∏ú‡∏π‡πâ‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£)</div>
                            <div class="calculator-panel" onclick="event.stopPropagation()">
                                <div class="sub-header" style="font-size:13px; font-weight:600;">1. ‡∏£‡∏∞‡∏î‡∏±‡∏ö 10 ‡∏Ç‡∏∂‡πâ‡∏ô‡πÑ‡∏õ (‡πÄ‡∏ö‡∏¥‡∏Å‡∏à‡∏£‡∏¥‡∏á)</div>
                                <div class="calc-row"><label style="width:50px;">‡∏£‡∏≤‡∏Ñ‡∏≤:</label><input type="number" id="accomLvl10Price" value="0" class="calc-input" style="width:70px;" oninput="updateAllBudgets()"> <label style="width:30px; text-align:right;">‡∏Ñ‡∏∑‡∏ô:</label><input type="number" id="accomLvl10Nights" value="0" class="calc-input" style="width:50px;" oninput="updateAllBudgets()"> <label style="width:30px; text-align:right;">‡∏Ñ‡∏ô:</label><input type="number" id="accomLvl10People" value="0" class="calc-input" style="width:50px;" oninput="updateAllBudgets()"></div>
                                
                                <div class="sub-header" style="font-size:13px; font-weight:600; margin-top:8px;">2. ‡∏£‡∏∞‡∏î‡∏±‡∏ö 9 ‡∏•‡∏á‡∏°‡∏≤ (‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô 2,400)</div>
                                <div class="calc-row"><label style="width:50px;">‡∏£‡∏≤‡∏Ñ‡∏≤:</label><input type="number" id="accomLvl9Price" value="2400" class="calc-input" style="width:70px;" oninput="updateAllBudgets()"> <label style="width:30px; text-align:right;">‡∏Ñ‡∏∑‡∏ô:</label><input type="number" id="accomLvl9Nights" value="0" class="calc-input" style="width:50px;" oninput="updateAllBudgets()"> <label style="width:30px; text-align:right;">‡∏Ñ‡∏ô:</label><input type="number" id="accomLvl9People" value="0" class="calc-input" style="width:50px;" oninput="updateAllBudgets()"></div>
                                
                                <div class="calc-result" id="accomTotalResult">‡∏£‡∏ß‡∏°: 0 ‡∏ö‡∏≤‡∏ó</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Driver (Prov Only) -->
                    <div class="task-item" id="task-budget-driver" data-type="prov-only" onclick="toggleTask(this)">
                        <div class="checkbox-custom"><svg viewBox="0 0 24 24" fill="currentColor"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/></svg></div>
                        <div class="task-content">
                            <span class="task-text">‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏ô‡∏Ç‡∏±‡∏ö‡∏£‡∏ñ</span>
                            <div class="calculator-panel" onclick="event.stopPropagation()">
                                <div class="sub-header" style="font-size:13px; font-weight:600;">1. ‡∏£‡∏ñ‡πÄ‡∏•‡πá‡∏Å (1,200)</div>
                                <div class="calc-row"><label style="width:50px;">‡∏Ñ‡∏ô‡∏Ç‡∏±‡∏ö:</label><input type="number" id="driverSmallQty" value="0" class="calc-input" style="width:60px;" oninput="updateAllBudgets()"> <label style="width:40px; text-align:right;">‡∏ß‡∏±‡∏ô:</label><input type="number" id="driverSmallDays" value="0" class="calc-input" style="width:60px;" oninput="updateAllBudgets()"></div>
                                
                                <div class="sub-header" style="font-size:13px; font-weight:600; margin-top:5px;">2. ‡∏£‡∏ñ‡πÉ‡∏´‡∏ç‡πà (1,400)</div>
                                <div class="calc-row"><label style="width:50px;">‡∏Ñ‡∏ô‡∏Ç‡∏±‡∏ö:</label><input type="number" id="driverBigQty" value="0" class="calc-input" style="width:60px;" oninput="updateAllBudgets()"> <label style="width:40px; text-align:right;">‡∏ß‡∏±‡∏ô:</label><input type="number" id="driverBigDays" value="0" class="calc-input" style="width:60px;" oninput="updateAllBudgets()"></div>
                                
                                <div class="sub-header" style="font-size:13px; font-weight:600; margin-top:5px;">3. ‡∏£‡∏ñ‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á (1,200)</div>
                                <div class="calc-row"><label style="width:50px;">‡∏Ñ‡∏ô‡∏Ç‡∏±‡∏ö:</label><input type="number" id="driverPosQty" value="0" class="calc-input" style="width:60px;" oninput="updateAllBudgets()"> <label style="width:40px; text-align:right;">‡∏ß‡∏±‡∏ô:</label><input type="number" id="driverPosDays" value="0" class="calc-input" style="width:60px;" oninput="updateAllBudgets()"></div>

                                <div class="calc-result" id="driverTotalResult">‡∏£‡∏ß‡∏°: 0 ‡∏ö‡∏≤‡∏ó</div>
                            </div>
                        </div>
                    </div>

                    <!-- Mechanic (Prov Only) -->
                     <div class="task-item" id="task-budget-mechanic" data-type="prov-only" onclick="toggleTask(this)">
                        <div class="checkbox-custom"><svg viewBox="0 0 24 24" fill="currentColor"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/></svg></div>
                        <div class="task-content">
                            <span class="task-text">‡∏Ñ‡πà‡∏≤‡∏ä‡πà‡∏≤‡∏á‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏£‡∏ñ</span>
                            <div class="calculator-panel" onclick="event.stopPropagation()">
                                <div class="calc-row"><label style="width:160px;">1. ‡∏Ñ‡πà‡∏≤‡πÄ‡∏ä‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏û‡∏±‡∏Å (1,800) x ‡∏ß‡∏±‡∏ô:</label><input type="number" id="mechAccomDays" value="0" class="calc-input" oninput="updateAllBudgets()"></div>
                                <div class="calc-row"><label style="width:160px;">2. ‡∏Ñ‡πà‡∏≤‡πÄ‡∏ö‡∏µ‡πâ‡∏¢‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á (800) x ‡∏ß‡∏±‡∏ô:</label><input type="number" id="mechAllowDays" value="0" class="calc-input" oninput="updateAllBudgets()"></div>
                                <div class="calc-result" id="mechTotalResult">‡∏£‡∏ß‡∏°: 0 ‡∏ö‡∏≤‡∏ó</div>
                            </div>
                        </div>
                    </div>

                </div>
                
                <!-- STEP 5 (Updated: SAP - Checklist Only) -->
                <div id="step-5" class="step-section theme-orange">
                    <div class="section-title"><div><span class="badge">‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 5</span> ‡∏•‡∏á‡∏£‡∏∞‡∏ö‡∏ö SAP</div></div>
                    
                    <div class="task-item" id="task-sap" data-type="all" onclick="toggleTask(this)">
                        <div class="checkbox-custom"><svg viewBox="0 0 24 24" fill="currentColor"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/></svg></div>
                        <div class="task-content">
                            <span class="task-text">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ù‡∏∂‡∏Å‡∏≠‡∏ö‡∏£‡∏°‡∏•‡∏á‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö</span>
                            <span class="task-detail">‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡πà‡∏≠‡πÑ‡∏õ‡∏ô‡∏µ‡πâ‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö SAP:</span>
                            <div style="margin-top:10px; padding:10px; background:#fff7ed; border-radius:8px; border:1px solid #fed7aa; color:#9a3412; font-size:14px;">
                                <div>‚Ä¢ D: ‡∏£‡∏´‡∏±‡∏™‡∏´‡∏•‡∏±‡∏Å‡∏™‡∏π‡∏ï‡∏£</div>
                                <div>‚Ä¢ E: ‡∏£‡∏∏‡πà‡∏ô‡∏Ç‡∏≠‡∏á‡∏´‡∏•‡∏±‡∏Å‡∏™‡∏π‡∏ï‡∏£</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- STEP 6 (Summary) -->
                <div id="step-6" class="step-section theme-blue">
                    <div class="section-title"><div><span class="badge">‡∏™‡∏£‡∏∏‡∏õ</span> ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£</div></div>
                    <div class="summary-box">
                        
                        <div class="summary-row" style="border-bottom: 2px solid #e2e8f0; padding-bottom:12px; margin-bottom:12px;">
                            <span style="font-weight:700;">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ú‡∏π‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏≠‡∏ö‡∏£‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</span>
                            <span id="sum-trainees" style="font-weight:700; color:var(--primary);">0 ‡∏Ñ‡∏ô</span>
                        </div>
                        <div class="summary-row"><span>‡∏Ñ‡πà‡∏≤‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏Å‡∏£</span><span id="sum-speaker">0 ‡∏ö‡∏≤‡∏ó</span></div>
                        <div class="summary-row"><span id="sum-lunch-label">‡∏Ñ‡πà‡∏≤‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏Å‡∏•‡∏≤‡∏á‡∏ß‡∏±‡∏ô (800.-)</span><span id="sum-lunch">0 ‡∏ö‡∏≤‡∏ó</span></div>
                        <div class="summary-row" id="row-snack-int"><span>‡∏Ñ‡πà‡∏≤‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏ß‡πà‡∏≤‡∏á (‡∏†‡∏≤‡∏¢‡πÉ‡∏ô)</span><span id="sum-snack-int">0 ‡∏ö‡∏≤‡∏ó</span></div>
                        <div class="summary-row hidden-visually" id="row-snack-ext"><span>‡∏Ñ‡πà‡∏≤‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏ß‡πà‡∏≤‡∏á (‡∏†‡∏≤‡∏¢‡∏ô‡∏≠‡∏Å)</span><span id="sum-snack-ext">0 ‡∏ö‡∏≤‡∏ó</span></div>
                        
                        <!-- Other Expenses (All) -->
                        <div class="summary-row" id="row-other-exp"><span>‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡∏≠‡∏∑‡πà‡∏ô‡πÜ</span><span id="sum-other-exp">0 ‡∏ö‡∏≤‡∏ó</span></div>
                        
                        <!-- Prov Only -->
                        <div class="summary-row hidden-visually" id="row-accom"><span>‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏û‡∏±‡∏Å</span><span id="sum-accom">0 ‡∏ö‡∏≤‡∏ó</span></div>
                        <div class="summary-row hidden-visually" id="row-driver"><span>‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏ô‡∏Ç‡∏±‡∏ö‡∏£‡∏ñ</span><span id="sum-driver">0 ‡∏ö‡∏≤‡∏ó</span></div>
                        <div class="summary-row hidden-visually" id="row-mechanic"><span>‡∏Ñ‡πà‡∏≤‡∏ä‡πà‡∏≤‡∏á‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏£‡∏ñ</span><span id="sum-mechanic">0 ‡∏ö‡∏≤‡∏ó</span></div>

                        <div class="summary-total"><span>‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏™‡∏¥‡πâ‡∏ô</span><span id="sum-grand-total">0 ‡∏ö‡∏≤‡∏ó</span></div>
                    </div>
                    <button class="nav-btn btn-save" onclick="manualSave()">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏ö‡∏ö‡∏£‡πà‡∏≤‡∏á</button>
                    <button class="nav-btn btn-print" onclick="saveAsPDF()">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏õ‡πá‡∏ô PDF</button>
                    <button class="nav-btn btn-print" style="background:#ef4444; border-color:#ef4444; margin-top:5px;" onclick="confirmRestart()">üîÑ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ó‡∏≥‡πÉ‡∏´‡∏°‡πà (Reset)</button>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <div class="footer hidden-visually" id="footer-area">
            <button id="btn-prev" class="nav-btn btn-prev" onclick="prevStep()">‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö</button>
            <button id="btn-next" class="nav-btn btn-next" onclick="nextStep()">‡∏ñ‡∏±‡∏î‡πÑ‡∏õ</button>
        </div>
        
        <!-- Selection Modal -->
        <div class="modal-overlay" id="typeModal">
            <div class="modal-box">
                <div class="modal-title">‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡∏°‡πà</div>
                <input type="text" id="newProjectNameInput" class="modal-input" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£ (‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô)..." maxlength="50">
                
                <!-- Step 1: Main Type -->
                <div id="modal-step-1">
                    <p style="margin-top:15px; margin-bottom:10px; color:var(--text-muted); font-size:14px;">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Å‡∏≤‡∏£‡∏≠‡∏ö‡∏£‡∏°</p>
                    <div class="modal-grid">
                        <div class="select-card" onclick="selectMainType('internal')">
                            <span class="select-icon">üè¢</span>
                            <b>‡∏≠‡∏ö‡∏£‡∏°‡∏†‡∏≤‡∏¢‡πÉ‡∏ô</b>
                        </div>
                        <div class="select-card" onclick="selectMainType('external')">
                            <span class="select-icon">üöå</span>
                            <b>‡∏≠‡∏ö‡∏£‡∏°‡∏†‡∏≤‡∏¢‡∏ô‡∏≠‡∏Å</b>
                        </div>
                    </div>
                </div>

                <!-- Step 2: External Sub-Type -->
                <div id="modal-step-2" class="hidden-visually">
                    <p style="margin-top:15px; margin-bottom:10px; color:var(--text-muted); font-size:14px;">‡∏£‡∏∞‡∏ö‡∏∏‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏≠‡∏ö‡∏£‡∏°‡∏†‡∏≤‡∏¢‡∏ô‡∏≠‡∏Å</p>
                    <div class="modal-grid">
                        <div class="select-card" onclick="selectExtType('bkk')">
                            <span class="select-icon">üè®</span>
                            <b>‡πÉ‡∏ô‡∏Å‡∏£‡∏∏‡∏á‡πÄ‡∏ó‡∏û‡∏Ø</b>
                            <span style="font-size:11px; color:var(--text-muted);">(‡πÇ‡∏£‡∏á‡πÅ‡∏£‡∏°)</span>
                        </div>
                        <div class="select-card" onclick="selectExtType('prov')">
                            <span class="select-icon">üåÑ</span>
                            <b>‡∏ï‡πà‡∏≤‡∏á‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î</b>
                        </div>
                    </div>
                    <button style="margin-top:20px; font-size:13px; background:none; border:none; color:#64748b; cursor:pointer;" onclick="backToStep1()">‚Üê ‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö</button>
                </div>

                <button style="margin-top:20px; background:none; border:none; text-decoration:underline; cursor:pointer;" onclick="closeModal('typeModal')">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
            </div>
        </div>
        
        <!-- Rename Modal -->
        <div class="modal-overlay" id="renameModal">
            <div class="modal-box">
                <div class="modal-title">‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏°</div>
                <input type="text" id="renameInput" class="modal-input" placeholder="‡πÉ‡∏™‡πà‡∏ä‡∏∑‡πà‡∏≠‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡∏°‡πà..." maxlength="30">
                <div class="modal-grid">
                    <button class="nav-btn btn-prev" style="justify-content:center;" onclick="closeModal('renameModal')">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                    <button class="nav-btn btn-next" style="justify-content:center;" onclick="confirmRename()">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
                </div>
            </div>
        </div>

        <!-- Confirm Modal -->
        <div class="modal-overlay" id="confirmModal">
            <div class="modal-box">
                <div class="modal-title" id="confirmTitle">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô</div>
                <p id="confirmText">‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°</p>
                <div class="modal-grid">
                    <button class="nav-btn btn-prev" style="justify-content:center;" onclick="closeModal('confirmModal')">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                    <button class="nav-btn btn-next" style="justify-content:center;" id="confirmActionBtn">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô</button>
                </div>
            </div>
        </div>

        <!-- Save Success Modal -->
        <div class="modal-overlay" id="saveActionModal">
            <div class="modal-box">
                <div class="modal-title" style="color:#10b981;">‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢</div>
                <p>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ñ‡∏π‡∏Å‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÉ‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏•‡πâ‡∏ß</p>
                <div class="modal-grid">
                    <button class="nav-btn btn-prev" style="justify-content:center;" onclick="closeModal('saveActionModal')">‡∏≠‡∏¢‡∏π‡πà‡∏´‡∏ô‡πâ‡∏≤‡∏ô‡∏µ‡πâ‡∏ï‡πà‡∏≠</button>
                    <button class="nav-btn btn-next" style="justify-content:center;" onclick="closeModal('saveActionModal'); confirmBackToHome();">‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</button>
                </div>
            </div>
        </div>

    </div>

    <script>
        // --- DATA MANAGEMENT ---
        const SLOT_PREFIX = 'checklist_slot_';
        let currentSlotId = null;
        let currentSlotName = '';
        let currentMode = ''; // 'internal', 'external'
        let currentExtType = 'bkk'; // 'bkk', 'prov' (Default BKK)
        let currentStep = 1;
        const totalSteps = 6;
        const formatter = new Intl.NumberFormat('th-TH', { style: 'currency', currency: 'THB', minimumFractionDigits: 0 });

        // On Load
        document.addEventListener('DOMContentLoaded', () => { renderSlots(); });

        function renderSlots() {
            const container = document.getElementById('slots-container');
            container.innerHTML = '';
            for (let i = 1; i <= 5; i++) {
                const data = localStorage.getItem(SLOT_PREFIX + i);
                const slotData = data ? JSON.parse(data) : null;
                const card = document.createElement('div');
                card.className = `slot-card ${slotData ? '' : 'empty'}`;
                
                if (slotData) {
                    let typeLabel = slotData.mode === 'internal' ? 'üè¢ ‡∏†‡∏≤‡∏¢‡πÉ‡∏ô' : 'üöå ‡∏†‡∏≤‡∏¢‡∏ô‡∏≠‡∏Å';
                    if(slotData.mode === 'external') {
                        typeLabel += (slotData.extType === 'prov' ? ' (‡∏ï‡πà‡∏≤‡∏á‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î)' : ' (‡∏Å‡∏ó‡∏°.)');
                    }
                    const date = new Date(slotData.lastSaved).toLocaleDateString('th-TH', { day: 'numeric', month: 'short', hour:'2-digit', minute:'2-digit' });
                    card.innerHTML = `
                        <div class="slot-info" onclick="loadSlot(${i})">
                            <h3>${slotData.name || `Form #${i}`}</h3>
                            <p style="margin-bottom:5px;">${typeLabel}</p>
                            <span class="slot-status status-active">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î: ${date}</span>
                        </div>
                        <div class="slot-actions">
                             <button class="btn-icon btn-print-slot" onclick="printSlot(${i}, event)">üñ®Ô∏è</button>
                             <button class="btn-icon btn-edit" onclick="loadSlot(${i})">‚úèÔ∏è</button>
                            <button class="btn-icon btn-delete" onclick="deleteSlot(${i}, event)">üóëÔ∏è</button>
                        </div>
                    `;
                } else {
                    card.innerHTML = `
                        <div class="slot-info" onclick="openTypeModal(${i})">
                            <h3 style="color:#94a3b8;">Form #${i} (‡∏ß‡πà‡∏≤‡∏á)</h3>
                            <p>‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÉ‡∏´‡∏°‡πà</p>
                        </div>
                        <div class="slot-actions"><button class="btn-icon" onclick="openTypeModal(${i})">‚ûï</button></div>
                    `;
                }
                container.appendChild(card);
            }
        }

        // --- SLOT & MODAL ACTIONS ---
        let tempSlotId = null;
        function openTypeModal(slotId) {
            tempSlotId = slotId;
            document.getElementById('newProjectNameInput').value = ''; 
            document.getElementById('newProjectNameInput').classList.remove('input-error');
            
            // Reset Modal View
            document.getElementById('modal-step-1').classList.remove('hidden-visually');
            document.getElementById('modal-step-2').classList.add('hidden-visually');
            
            document.getElementById('typeModal').classList.add('active');
            document.getElementById('newProjectNameInput').focus();
        }

        function selectMainType(type) {
            const nameInput = document.getElementById('newProjectNameInput');
            const name = nameInput.value.trim();
            if (!name) {
                nameInput.classList.add('input-error');
                return;
            }

            if (type === 'internal') {
                startNewSlot('internal', name, 'bkk'); // extType ignored for internal
            } else {
                // Show Step 2
                document.getElementById('modal-step-1').classList.add('hidden-visually');
                document.getElementById('modal-step-2').classList.remove('hidden-visually');
            }
        }

        function backToStep1() {
            document.getElementById('modal-step-1').classList.remove('hidden-visually');
            document.getElementById('modal-step-2').classList.add('hidden-visually');
        }

        function selectExtType(subType) {
            const name = document.getElementById('newProjectNameInput').value.trim(); // Name is already validated
            startNewSlot('external', name, subType);
        }

        function openRenameModal(slotId, event) {
            if(event) event.stopPropagation();
            tempSlotId = slotId;
            const data = JSON.parse(localStorage.getItem(SLOT_PREFIX + slotId));
            document.getElementById('renameInput').value = data.name || '';
            document.getElementById('renameModal').classList.add('active');
        }
        function confirmRename() {
            const newName = document.getElementById('renameInput').value.trim();
            if(!newName) return;
            const data = JSON.parse(localStorage.getItem(SLOT_PREFIX + tempSlotId));
            data.name = newName;
            if (currentSlotId === tempSlotId) currentSlotName = newName;
            localStorage.setItem(SLOT_PREFIX + tempSlotId, JSON.stringify(data));
            closeModal('renameModal');
            renderSlots();
            if(currentSlotId) enterApp(currentMode); // refresh header
        }
        function startNewSlot(mode, name, extType) {
            closeModal('typeModal');
            currentSlotId = tempSlotId;
            currentMode = mode;
            currentExtType = extType; 
            currentSlotName = name;
            resetFormUI();
            saveCurrentState();
            enterApp(mode);
        }
        function loadSlot(slotId) {
            const data = JSON.parse(localStorage.getItem(SLOT_PREFIX + slotId));
            if(!data) return;
            currentSlotId = slotId;
            currentMode = data.mode;
            currentExtType = data.extType || 'bkk';
            currentSlotName = data.name;
            resetFormUI();
            
            data.checkedItems.forEach(id => {
                const el = document.getElementById(id);
                if(el) {
                    if(el.tagName === 'INPUT' && el.type === 'checkbox') el.checked = true;
                    else el.classList.add('checked');
                }
            });
            for (const [key, value] of Object.entries(data.inputs)) {
                const el = document.getElementById(key);
                if(el && !el.disabled) {
                     if(el.type === 'checkbox') el.checked = (value === 'true');
                     else el.value = value;
                }
            }
            // Restore Dates
            const dateContainer = document.getElementById('date-rows-container');
            dateContainer.innerHTML = '';
            if (data.dateSchedule && data.dateSchedule.length > 0) {
                data.dateSchedule.forEach(item => addDateRow(item.start, item.end));
            } else {
                addDateRow();
            }
            enterApp(currentMode);
        }
        function printSlot(slotId, event) {
            if(event) event.stopPropagation();
            loadSlot(slotId); 
            showStep(6);
            setTimeout(() => window.print(), 300);
        }
        function deleteSlot(slotId, event) {
            if(event) event.stopPropagation();
            showConfirm('‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•', `‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô Form #${slotId} ‡πÉ‡∏ä‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?`, () => {
                localStorage.removeItem(SLOT_PREFIX + slotId);
                renderSlots();
                closeModal('confirmModal');
            });
        }
        function confirmRestart() {
            showConfirm('‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ó‡∏≥‡πÉ‡∏´‡∏°‡πà', '‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï', () => {
                resetFormUI();
                saveCurrentState();
                closeModal('confirmModal');
                showStep(1);
            });
        }
        function manualSave() {
            saveCurrentState();
            document.getElementById('saveActionModal').classList.add('active');
        }
        
        function saveAsPDF() {
            alert("‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡πÄ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á‡∏û‡∏¥‡∏°‡∏û‡πå\n‡πÇ‡∏õ‡∏£‡∏î‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏•‡∏≤‡∏¢‡∏ó‡∏≤‡∏á (Destination) ‡πÄ‡∏õ‡πá‡∏ô 'Save as PDF' ‡∏´‡∏£‡∏∑‡∏≠ '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏õ‡πá‡∏ô PDF'");
            window.print();
        }

        // --- APP LOGIC ---
        function enterApp(mode) {
            document.getElementById('welcome-screen').classList.add('hidden-visually');
            document.getElementById('checklist-steps').classList.remove('hidden-visually');
            document.getElementById('progress-area').classList.remove('hidden-visually');
            document.getElementById('step-nav').classList.remove('hidden-visually');
            document.getElementById('footer-area').classList.remove('hidden-visually');
            document.getElementById('header-home-btn').classList.remove('hidden-visually');
            document.getElementById('slot-indicator').classList.remove('hidden-visually');
            
            let badgeText = `${currentSlotName} (${mode==='internal'?'‡∏†‡∏≤‡∏¢‡πÉ‡∏ô':'‡∏†‡∏≤‡∏¢‡∏ô‡∏≠‡∏Å'}`;
            if(mode === 'external') badgeText += currentExtType==='prov' ? '-‡∏ï‡∏à‡∏ß.)' : '-‡∏Å‡∏ó‡∏°.)';
            else badgeText += ')';
            document.getElementById('slot-name-badge').innerText = badgeText;

            // Lunch Label Logic
            if (currentMode === 'external' && currentExtType === 'prov') {
                document.getElementById('lunchLabel').innerText = '‡∏Ñ‡πà‡∏≤‡∏≠‡∏≤‡∏´‡∏≤‡∏£';
                document.getElementById('sum-lunch-label').innerText = '‡∏Ñ‡πà‡∏≤‡∏≠‡∏≤‡∏´‡∏≤‡∏£';
            } else {
                document.getElementById('lunchLabel').innerText = '‡∏Ñ‡πà‡∏≤‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏Å‡∏•‡∏≤‡∏á‡∏ß‡∏±‡∏ô (800.-)';
                document.getElementById('sum-lunch-label').innerText = '‡∏Ñ‡πà‡∏≤‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏Å‡∏•‡∏≤‡∏á‡∏ß‡∏±‡∏ô (800.-)';
            }

            // Visibility Logic
            document.querySelectorAll('.task-item').forEach(el => el.classList.add('hidden')); // Hide all first
            
            // Show Shared
            document.querySelectorAll('.task-item[data-type="all"]').forEach(el => el.classList.remove('hidden'));

            if(mode === 'internal') {
                document.querySelectorAll('.task-item[data-type="internal"]').forEach(el => el.classList.remove('hidden'));
                
                document.getElementById('loc-internal-opt').classList.remove('hidden-visually');
                document.getElementById('loc-external-opt').classList.add('hidden-visually');
                
                // Summary Visibility
                document.getElementById('row-snack-int').classList.remove('hidden-visually');
                document.getElementById('row-snack-ext').classList.add('hidden-visually');
                // document.getElementById('row-other-exp').classList.add('hidden-visually'); // Now Visible for all
                document.getElementById('row-accom').classList.add('hidden-visually');
                document.getElementById('row-driver').classList.add('hidden-visually');
                document.getElementById('row-mechanic').classList.add('hidden-visually');
                
            } else {
                // External Base
                document.getElementById('loc-internal-opt').classList.add('hidden-visually');
                document.getElementById('loc-external-opt').classList.remove('hidden-visually');

                // Check Ext Subtype
                if(currentExtType === 'bkk') {
                     // BKK: Shared + Snack Ext + Other
                     document.querySelectorAll('.task-item[data-type="external"]').forEach(el => el.classList.remove('hidden'));
                     document.querySelectorAll('.task-item[data-type="bkk-only"]').forEach(el => el.classList.remove('hidden'));
                     
                     // Summary
                     document.getElementById('row-snack-int').classList.add('hidden-visually');
                     document.getElementById('row-snack-ext').classList.remove('hidden-visually');
                     // document.getElementById('row-other-exp').classList.remove('hidden-visually');
                     
                     document.getElementById('row-accom').classList.add('hidden-visually');
                     document.getElementById('row-driver').classList.add('hidden-visually');
                     document.getElementById('row-mechanic').classList.add('hidden-visually');

                } else {
                     // Prov: Shared + Snack Ext + Accom + Driver + Mechanic
                     document.querySelectorAll('.task-item[data-type="external"]').forEach(el => el.classList.remove('hidden'));
                     document.querySelectorAll('.task-item[data-type="prov-only"]').forEach(el => el.classList.remove('hidden'));

                     // Summary
                     document.getElementById('row-snack-int').classList.add('hidden-visually');
                     document.getElementById('row-snack-ext').classList.remove('hidden-visually');
                     // document.getElementById('row-other-exp').classList.add('hidden-visually'); 
                     
                     document.getElementById('row-accom').classList.remove('hidden-visually');
                     document.getElementById('row-driver').classList.remove('hidden-visually');
                     document.getElementById('row-mechanic').classList.remove('hidden-visually');
                }
            }
            
            updateAllBudgets();
            updateTraineeCount();
            calculateDays();
            showStep(1);
        }

        function saveCurrentState() {
            if(!currentSlotId) return;
            const checked = [];
            document.querySelectorAll('.task-item.checked').forEach(el => checked.push(el.id));
            document.querySelectorAll('input[type="checkbox"]:checked').forEach(el => checked.push(el.id));
            const inputs = {};
            document.querySelectorAll('input, select, textarea').forEach(el => {
                if(el.id && !el.classList.contains('date-start') && !el.classList.contains('date-end')) inputs[el.id] = el.value;
            });
            document.querySelectorAll('input[type="checkbox"]').forEach(el => { if(el.id) inputs[el.id] = el.checked ? 'true' : 'false'; });
            
            const dateRows = [];
            document.querySelectorAll('.date-row').forEach(row => {
                dateRows.push({
                    start: row.querySelector('.date-start').value,
                    end: row.querySelector('.date-end').value
                });
            });

            const data = {
                name: currentSlotName, mode: currentMode, extType: currentExtType,
                lastSaved: new Date().toISOString(), checkedItems: checked, inputs: inputs, dateSchedule: dateRows
            };
            localStorage.setItem(SLOT_PREFIX + currentSlotId, JSON.stringify(data));
        }

        function resetFormUI() {
            document.querySelectorAll('.task-item').forEach(el => el.classList.remove('checked'));
            document.querySelectorAll('input[type="checkbox"]').forEach(el => el.checked = false);
            document.querySelectorAll('input').forEach(input => {
                if (input.disabled || input.type === 'radio') return;
                if (input.type === 'number') input.value = 0;
                else input.value = '';
            });
            
            // Set defaults if needed
            document.getElementById('accomLvl9Price').value = 2400;

            document.getElementById('date-rows-container').innerHTML = '';
            addDateRow();
            updateAllBudgets();
        }

        // --- CALCULATION LOGIC ---
        
        // Wrapper for auto-save
        function wrap(fn) { return function() { fn.apply(this, arguments); saveCurrentState(); }}
        
        window.updateAllBudgets = wrap(_updateAllBudgets);
        window.updateTraineeCount = wrap(_updateTraineeCount);
        window.calculateDays = wrap(_calculateDays);
        window.addDateRow = wrap(_addDateRow);
        window.removeDateRow = wrap(_removeDateRow);

        function _updateAllBudgets() {
            // 1. Lecturer
            const intTotal = val('speakerIntHours') * 400;
            const extRate = val('speakerExtRate');
            const extTotal = val('speakerExtHours') * extRate;
            document.getElementById('speakerTotalResult').innerText = `‡∏£‡∏ß‡∏°: ${formatter.format(intTotal + extTotal)}`;
            document.getElementById('sum-speaker').innerText = formatter.format(intTotal + extTotal);

            // 2. Lunch (800)
            const lunchTotal = val('lunchPeople') * val('lunchMeals') * 800;
            document.getElementById('lunchTotalResult').innerText = `‡∏£‡∏ß‡∏°: ${formatter.format(lunchTotal)}`;
            document.getElementById('sum-lunch').innerText = formatter.format(lunchTotal);

            // 3. Snack
            let snackTotal = 0;
            if (currentMode === 'internal') {
                snackTotal = val('snackIntPeople') * val('snackIntMeals') * 50;
                document.getElementById('snackIntResult').innerText = `‡∏£‡∏ß‡∏°: ${formatter.format(snackTotal)}`;
                document.getElementById('sum-snack-int').innerText = formatter.format(snackTotal);
            } else {
                snackTotal = val('snackExtPeople') * val('snackExtMeals') * 300;
                document.getElementById('snackExtResult').innerText = `‡∏£‡∏ß‡∏°: ${formatter.format(snackTotal)}`;
                document.getElementById('sum-snack-ext').innerText = formatter.format(snackTotal);
            }

            // 4. Other (Now just Total)
            let otherTotal = val('otherExpTotal');
            document.getElementById('otherExpResult').innerText = `‡∏£‡∏ß‡∏°: ${formatter.format(otherTotal)}`;
            document.getElementById('sum-other-exp').innerText = formatter.format(otherTotal);

            // 5. Accom (Prov)
            let accomTotal = 0;
            if (currentMode === 'external' && currentExtType === 'prov') {
                const l10 = val('accomLvl10Price') * val('accomLvl10Nights') * val('accomLvl10People');
                const l9 = val('accomLvl9Price') * val('accomLvl9Nights') * val('accomLvl9People');
                accomTotal = l10 + l9;
                document.getElementById('accomTotalResult').innerText = `‡∏£‡∏ß‡∏°: ${formatter.format(accomTotal)}`;
                document.getElementById('sum-accom').innerText = formatter.format(accomTotal);
            }

            // 6. Driver (Prov)
            let driverTotal = 0;
            if (currentMode === 'external' && currentExtType === 'prov') {
                const t1 = 1200 * val('driverSmallQty') * val('driverSmallDays');
                const t2 = 1400 * val('driverBigQty') * val('driverBigDays');
                const t3 = 1200 * val('driverPosQty') * val('driverPosDays');
                driverTotal = t1 + t2 + t3;
                document.getElementById('driverTotalResult').innerText = `‡∏£‡∏ß‡∏°: ${formatter.format(driverTotal)}`;
                document.getElementById('sum-driver').innerText = formatter.format(driverTotal);
            }

            // 7. Mechanic (Prov)
            let mechTotal = 0;
            if (currentMode === 'external' && currentExtType === 'prov') {
                const m1 = 1800 * val('mechAccomDays');
                const m2 = 800 * val('mechAllowDays');
                mechTotal = m1 + m2;
                document.getElementById('mechTotalResult').innerText = `‡∏£‡∏ß‡∏°: ${formatter.format(mechTotal)}`;
                document.getElementById('sum-mechanic').innerText = formatter.format(mechTotal);
            }

            // Grand Total
            let grand = (intTotal + extTotal) + lunchTotal + snackTotal + otherTotal + accomTotal + driverTotal + mechTotal;
            document.getElementById('sum-grand-total').innerText = formatter.format(grand);
        }

        function _updateTraineeCount() {
            const total = val('traineeNormal') + val('traineeShift');
            document.getElementById('traineeTotalResult').innerText = `‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: ${total} ‡∏Ñ‡∏ô`;
            document.getElementById('sum-trainees').innerText = `${total} ‡∏Ñ‡∏ô`;
        }

        function _calculateDays() {
            let total = 0;
            document.querySelectorAll('.date-row').forEach(row => {
                const d1 = new Date(row.querySelector('.date-start').value);
                const d2 = new Date(row.querySelector('.date-end').value);
                if (!isNaN(d1) && !isNaN(d2)) total += Math.ceil(Math.abs(d2 - d1) / (86400000)) + 1;
            });
            document.getElementById('trainingDaysResult').innerText = `‡∏£‡∏ß‡∏°‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤: ${total} ‡∏ß‡∏±‡∏ô`;
        }

        function _addDateRow(s='', e='') {
            const div = document.createElement('div');
            div.className = 'date-row';
            div.innerHTML = `<label style="width:30px;">‡πÄ‡∏£‡∏¥‡πà‡∏°:</label><input type="date" class="calc-input date-start" value="${s}" onchange="calculateDays()"><label style="width:30px; text-align:right;">‡∏ñ‡∏∂‡∏á:</label><input type="date" class="calc-input date-end" value="${e}" onchange="calculateDays()"><button class="remove-date-btn" onclick="removeDateRow(this); event.stopPropagation();">‡∏•‡∏ö</button>`;
            document.getElementById('date-rows-container').appendChild(div);
        }
        function _removeDateRow(btn) { btn.parentElement.remove(); _calculateDays(); saveCurrentState(); }

        function val(id) { return parseFloat(document.getElementById(id).value) || 0; }

        // --- NAV & UTILS ---
        function showStep(idx) {
            for(let i=1; i<=totalSteps; i++) {
                document.getElementById(`step-${i}`).classList.remove('active');
                document.getElementById(`dot-${i}`).classList.remove('active', 'completed');
                if(i<idx) document.getElementById(`dot-${i}`).classList.add('completed');
            }
            document.getElementById(`step-${idx}`).classList.add('active');
            document.getElementById(`dot-${idx}`).classList.add('active');
            
            document.getElementById('btn-prev').disabled = (idx === 1);
            document.getElementById('btn-next').style.display = (idx === totalSteps) ? 'none' : 'flex';
            document.getElementById('btn-next').innerText = (idx === 6) ? '‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•' : '‡∏ñ‡∏±‡∏î‡πÑ‡∏õ';
            currentStep = idx;
            
            if(idx === 6) updateAllBudgets();
        }
        function nextStep() { if(currentStep < totalSteps) showStep(currentStep + 1); }
        function prevStep() { if(currentStep > 1) showStep(currentStep - 1); }
        function toggleTask(el) { el.classList.toggle('checked'); updateProgress(); saveCurrentState(); }
        function updateProgress() {
            const visible = Array.from(document.querySelectorAll('.task-item:not(.hidden):not(.hidden-visually)'));
            if(visible.length === 0) return;
            const checked = visible.filter(e => e.classList.contains('checked')).length;
            const pct = Math.round((checked / visible.length) * 100);
            document.getElementById('progressBar').style.width = pct + '%';
            document.getElementById('percentText').innerText = pct + '%';
        }
        function confirmBackToHome() {
            document.getElementById('checklist-steps').classList.add('hidden-visually');
            document.getElementById('welcome-screen').classList.remove('hidden-visually');
            document.getElementById('progress-area').classList.add('hidden-visually');
            document.getElementById('step-nav').classList.add('hidden-visually');
            document.getElementById('footer-area').classList.add('hidden-visually');
            document.getElementById('header-home-btn').classList.add('hidden-visually');
            document.getElementById('slot-indicator').classList.add('hidden-visually');
            renderSlots();
        }
        function showConfirm(t, tx, act) {
            document.getElementById('confirmTitle').innerText = t;
            document.getElementById('confirmText').innerText = tx;
            document.getElementById('confirmActionBtn').onclick = act;
            document.getElementById('confirmModal').classList.add('active');
        }
        function closeModal(id) { document.getElementById(id).classList.remove('active'); }
        function forcePrint() { window.print(); }
        function copyContactEmail(btn) {
            navigator.clipboard.writeText('nutthapol.kaewr@airportthai.co.th');
            const originalText = btn.innerHTML;
            btn.innerHTML = '‚úÖ ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢';
            setTimeout(() => { btn.innerHTML = originalText; }, 2000);
        }
    </script>
</body>
</html>
